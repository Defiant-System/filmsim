function t(){let t=4022871197,e=e=>{for(let a=0,n=(e=e.toString()).length;a<n;a++){t+=e.charCodeAt(a);let n=.02519603282416938*t;t=n>>>0,n-=t,n*=t,t=n>>>0,n-=t,t+=4294967296*n}return 2.3283064365386963e-10*(t>>>0)};return e.version="Mash 0.9",e}function e(){return function(e){let a=0,n=0,i=0,r=1;0==e.length&&(e=[+new Date]);let h=t();a=h(" "),n=h(" "),i=h(" ");for(let t=0,r=e.length;t<r;t++)a-=h(e[t]),a<0&&(a+=1),n-=h(e[t]),n<0&&(n+=1),i-=h(e[t]),i<0&&(i+=1);h=null;let l=function(){let t=2091639*a+2.3283064365386963e-10*r;return a=n,n=i,i=t-(r=0|t)};return l.uint32=function(){return 4294967296*l()},l.fract53=function(){return l()+11102230246251565e-32*(2097152*l()|0)},l.version="Alea 0.9",l.args=e,l.exportState=function(){return[a,n,i,r]},l.importState=function(t){a=+t[0]||0,n=+t[1]||0,i=+t[2]||0,r=+t[3]||0},l}(Array.prototype.slice.call(arguments))}e.importState=function(t){let a=new e;return a.importState(t),a};class a{constructor(t){this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6;let a=Math.random;"function"==typeof t?a=t:t&&(a=new e(t).random),this.p=new Uint8Array(256),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let t=0;t<256;t++)this.p[t]=256*a();for(let t=0;t<512;t++)this.perm[t]=this.p[255&t],this.permMod12[t]=this.perm[t]%12;this.grad3=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),this.grad4=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0])}noise2D(t,e){let a,n,i=this.permMod12,r=this.perm,h=this.grad3,l=0,o=0,s=0,f=(t+e)*this.F2,u=Math.floor(t+f),c=Math.floor(e+f),d=(u+c)*this.G2,M=t-(u-d),g=e-(c-d);M>g?(a=1,n=0):(a=0,n=1);let m=M-a+this.G2,p=g-n+this.G2,w=M-1+2*this.G2,y=g-1+2*this.G2,x=255&u,D=255&c,b=.5-M*M-g*g;if(b>=0){let t=3*i[x+r[D]];b*=b,l=b*b*(h[t]*M+h[t+1]*g)}let v=.5-m*m-p*p;if(v>=0){let t=3*i[x+a+r[D+n]];v*=v,o=v*v*(h[t]*m+h[t+1]*p)}let A=.5-w*w-y*y;if(A>=0){let t=3*i[x+1+r[D+1]];A*=A,s=A*A*(h[t]*w+h[t+1]*y)}return 70*(l+o+s)}}function n(t,e,a){return Math.min(Math.max(t,e),a)}function i(t){let e=Math.floor(t),a=t-e;return Math.random()>a?e:Math.ceil(t)}function r(t,e,a){let i=t.data,r=e.data,[h,l,o]=function(t){let e,a,i;return(t*=.01)<=66?(e=255,a=99.4708025861*Math.log(t)-161.1195681661,i=t<=19?0:138.5177312231*Math.log(t-10)-305.0447927307):(e=329.698727446*Math.pow(t-60,-.1332047592),a=288.1221695283*Math.pow(t-60,-.0755148492),i=255),[n(e,0,255),n(a,0,255),n(i,0,255)]}(a),s=.2126*h+.7152*l+.0722*o;h=s/h,l=s/l,o=s/o;for(let t=0;t<i.length;t+=4)r[t]=i[t]*h,r[t+1]=i[t+1]*l,r[t+2]=i[t+2]*o}function h(t,e,a,n){t[0]=e[0]+(a[0]-e[0])*n,t[1]=e[1]+(a[1]-e[1])*n,t[2]=e[2]+(a[2]-e[2])*n}function l(t,e,a,n,i,r){let h=4*(r*a*a+i*a+n);t[0]=e[h],t[1]=e[h+1],t[2]=e[h+2]}function o(t,o,s){(s.brightness&&1!==s.brightness||s.contrast||s.saturation||s.vibrance||s.temperature||s.blacks)&&function(t,e,a,r,h,l,o){let s=t.data,f=e.data;a/=1-o;for(let t=0;t<s.length;t+=4){let e=f[t]/255,u=f[t+1]/255,c=f[t+2]/255,d=(.2126*e+.7152*u+.0722*c)/1;e=Math.max(0,e-o),u=Math.max(0,u-o),c=Math.max(0,c-o);let M=Math.max(e,u,c),g=Math.min(e,u,c),m=(M+g)/2,p=.8,w=h+l*n((1-1.5*(m<.5?(M-g)/(1e-5+M+g):(M-g)/(1e-5+Math.max(0,2-M-g)))+(1+2*Math.abs(m-.5))*(1-p))/(1-p+1),0,1);e+=(e-d)*w,u+=(u-d)*w,c+=(c-d)*w,e+=(e-.5)*r,u+=(u-.5)*r,c+=(c-.5)*r,e*=a,u*=a,c*=a,s[t]=i(255*e),s[t+1]=i(255*u),s[t+2]=i(255*c)}}(t,t,s.brightness||1,s.contrast||0,s.saturation||0,s.vibrance||0,s.blacks||0),s.temperature&&6500!=s.temperature&&r(t,t,s.temperature),s.vignette&&s.vignette.intensity>0&&function(t,e,a,n,r,h){let l=t.data,o=e.data,s=e.width,f=e.height,u=a.x,c=a.y,d=a.height,M=a.width,g=Math.min(a.width,a.height);for(let t=0;t<f;t++){let e=(t+c-d/2)/g;e*=e;for(let a=0;a<s;a++){let f=4*(t*s+a),c=(a+u-M/2)/g;c*=c;let d=Math.sqrt(c+e),m=1-Math.min(1,Math.max(0,(d-n)/r))*(1-1/h);l[f]=i(o[f]*m),l[f+1]=i(o[f+1]*m),l[f+2]=i(o[f+2]*m)}}}(t,t,o,s.vignette.radius,s.vignette.falloff,s.vignette.intensity),s.grain&&s.grain.intensity>0&&function(t,n,i,r,h){let l=new a(new e),o=t.data,s=n.data,f=n.width,u=n.height,c=i.x,d=i.y,M=Math.min(i.width,i.height);for(let t=0;t<u;t++)for(let e=0;e<f;e++){let a=4*(t*f+e),n=(s[a]+s[a+1]+s[a+2])/768-.5,i=e+c,u=t+d,g=.5*(l.noise2D(i/M*r,u/M*r)+.25*l.noise2D(i/M*r/2,u/M*r/2)+l.noise2D(i/M*r/4,u/M*r/4));g*=1-n*n*2,g*=255*h,o[a]=s[a]+g,o[a+1]=s[a+1]+g,o[a+2]=s[a+2]+g}}(t,t,o,s.grain.scale,s.grain.intensity),s.clut&&(s.highQuality?function(t,e,a,n){let i=t.data,r=e.data,o=t.width,s=t.height,f=a.data,u=Math.floor(Math.pow(a.width,1/3)+.001),c=u*u,d=c-1,M=[0,0,0],g=[0,0,0],m=[0,0,0],p=[0,0,0],w=[0,0,0],y=[0,0,0],x=[0,0,0],D=[0,0,0];for(let t=0;t<s;t++)for(let e=0;e<o;e++){let a=4*(t*o+e),s=r[a]/256*d,u=r[a+1]/256*d,b=r[a+2]/256*d,v=r[a+3]/256,A=Math.floor(s),k=Math.ceil(s),G=Math.floor(u),L=Math.ceil(u),S=Math.floor(b),F=Math.ceil(b);l(M,f,c,A,G,S),l(g,f,c,A,G,F),l(m,f,c,A,L,S),l(p,f,c,A,L,F),l(w,f,c,k,G,S),l(y,f,c,k,G,F),l(x,f,c,k,L,S),l(D,f,c,k,L,F);let q=b-S;h(M,M,g,q),h(m,m,p,q),h(w,w,y,q),h(x,x,D,q),q=u-G,h(M,M,m,q),h(w,w,x,q),q=s-A,h(M,M,w,q);let U=1-n,C=n;i[a]=r[a]*U+M[0]*C,i[a+1]=i[a+1]*U+M[1]*C,i[a+2]=i[a+2]*U+M[2]*C,i[a+3]=256*v}}(t,t,s.clut,s.clutMix):function(t,e,a,n){let r=t.data,h=e.data,l=t.width,o=t.height,s=a.data,f=Math.floor(Math.pow(a.width,1/3)+.001),u=f*f,c=u-1,d=1-n,M=n;for(let t=0;t<o;t++)for(let e=0;e<l;e++){let a=4*(t*l+e),n=h[a]/255*c,o=h[a+1]/255*c,f=h[a+2]/255*c,g=h[a+3]/255,m=4*(i(f)*u*u+i(o)*u+i(n));r[a]=h[a]*d+M*s[m],r[a+1]=h[a+1]*d+M*s[m+1],r[a+2]=h[a+2]*d+M*s[m+2],r[a+3]=255*g}}(t,t,s.clut,s.clutMix)),s.lightLeak&&s.lightLeak.seed>0&&function(t,n,i,r,h,l){let o=new a(new e(l)),s=t.data,f=n.data,u=n.width,c=n.height,d=i.x,M=i.y,g=Math.min(i.width,i.height);for(let t=0;t<c;t++)for(let e=0;e<u;e++){let a=4*(t*u+e),n=e+d,i=t+M,l=.5*(o.noise2D(n/g*h,i/g*h)+.25*o.noise2D(n/g*h/2,i/g*h/2)+o.noise2D(n/g*h/4,i/g*h/4)),c=.5*o.noise2D(n/g*h,i/g*h+1e3)+1,m=.5*o.noise2D(n/g*h+1e3,i/g*h)+1,p=.5*o.noise2D(n/g*h+1e3,i/g*h+1e3)+1;l*=l,l*=255*r,s[a]=f[a]+l*c,s[a+1]=f[a+1]+l*m,s[a+2]=f[a+2]+l*p}}(t,t,o,s.lightLeak.intensity||1,s.lightLeak.scale,s.lightLeak.seed)}let s,f={setClut:t=>{s=t},processImage:(t,e,a)=>{o(t,e,a),self.postMessage(t,[t.data.buffer])}};self.onmessage=function(t){f[t.data.command].apply(self,t.data.arguments)};